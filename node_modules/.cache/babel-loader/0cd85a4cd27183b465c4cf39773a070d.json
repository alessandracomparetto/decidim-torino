{"ast":null,"code":"import \"src/decidim/geocoding\";\nimport formatAddress from \"src/decidim/geocoding/format_address\";\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n\n$(function () {\n  var generateAddressLabel = formatAddress;\n  $(\"[data-decidim-geocoding]\").each(function (_i, el) {\n    var $input = $(el);\n    var config = $input.data(\"decidim-geocoding\");\n    var queryMinLength = config.queryMinLength || 2;\n    var addressFormat = config.addressFormat || [[\"street\", \"houseNumber\"], \"district\", \"city\", \"county\", \"state\", \"country\"];\n    var language = $(\"html\").attr(\"lang\");\n    var currentSuggestionQuery = null;\n\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", function (_ev, query, callback) {\n      clearTimeout(currentSuggestionQuery); // Do not trigger API calls on short queries\n\n      if (\"\".concat(query).trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(function () {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json\",\n          data: {\n            apiKey: config.apiKey,\n            query: query,\n            language: language\n          },\n          dataType: \"json\"\n        }).done(function (resp) {\n          if (resp.suggestions) {\n            return callback(resp.suggestions.map(function (item) {\n              var label = generateAddressLabel(item.address, addressFormat);\n              return {\n                key: label,\n                value: label,\n                locationId: item.locationId\n              };\n            }));\n          }\n\n          return null;\n        });\n      }, 200);\n    });\n    $input.on(\"geocoder-suggest-select.decidim\", function (_ev, selectedItem) {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://geocoder.ls.hereapi.com/6.2/geocode.json\",\n        data: {\n          apiKey: config.apiKey,\n          gen: 9,\n          jsonattributes: 1,\n          locationid: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done(function (resp) {\n        if (!resp.response || !Array.isArray(resp.response.view) || resp.response.view.length < 1) {\n          return;\n        }\n\n        var view = resp.response.view[0];\n\n        if (!Array.isArray(view.result) || view.result.length < 1) {\n          return;\n        }\n\n        var result = view.result[0];\n        var coordinates = [result.location.displayPosition.latitude, result.location.displayPosition.longitude];\n        $input.trigger(\"geocoder-suggest-coordinates.decidim\", [coordinates]);\n      });\n    });\n  });\n});","map":{"version":3,"mappings":"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","names":["formatAddress","$","generateAddressLabel","each","_i","el","$input","config","data","queryMinLength","addressFormat","language","attr","currentSuggestionQuery","apiKey","length","on","_ev","query","callback","clearTimeout","trim","setTimeout","ajax","method","url","dataType","done","resp","suggestions","map","item","label","address","key","value","locationId","selectedItem","gen","jsonattributes","locationid","response","Array","isArray","view","result","coordinates","location","displayPosition","latitude","longitude","trigger"],"sources":["/var/lib/gems/2.7.0/gems/decidim-core-0.26.0/app/packs/src/decidim/geocoding/provider/here.js"],"sourcesContent":["import \"src/decidim/geocoding\"\nimport formatAddress from \"src/decidim/geocoding/format_address\"\n\n/**\n * For the available address format keys, refer to:\n * https://developer.here.com/documentation/geocoder-autocomplete/dev_guide/topics/resource-type-response-suggest.html\n */\n$(() => {\n  const generateAddressLabel = formatAddress;\n\n  $(\"[data-decidim-geocoding]\").each((_i, el) => {\n    const $input = $(el);\n    const config = $input.data(\"decidim-geocoding\");\n    const queryMinLength = config.queryMinLength || 2;\n    const addressFormat = config.addressFormat || [\n      [\"street\", \"houseNumber\"],\n      \"district\",\n      \"city\",\n      \"county\",\n      \"state\",\n      \"country\"\n    ];\n    const language = $(\"html\").attr(\"lang\");\n    let currentSuggestionQuery = null;\n\n    if (!config.apiKey || config.apiKey.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", (_ev, query, callback) => {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (`${query}`.trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(() => {\n        $.ajax({\n          method: \"GET\",\n          url: \"https://autocomplete.geocoder.ls.hereapi.com/6.2/suggest.json\",\n          data: {\n            apiKey: config.apiKey,\n            query: query,\n            language: language\n          },\n          dataType: \"json\"\n        }).done((resp) => {\n          if (resp.suggestions) {\n            return callback(resp.suggestions.map((item) => {\n              const label = generateAddressLabel(item.address, addressFormat);\n\n              return {\n                key: label,\n                value: label,\n                locationId: item.locationId\n              }\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n\n    $input.on(\"geocoder-suggest-select.decidim\", (_ev, selectedItem) => {\n      $.ajax({\n        method: \"GET\",\n        url: \"https://geocoder.ls.hereapi.com/6.2/geocode.json\",\n        data: {\n          apiKey: config.apiKey,\n          gen: 9,\n          jsonattributes: 1,\n          locationid: selectedItem.locationId\n        },\n        dataType: \"json\"\n      }).done((resp) => {\n        if (!resp.response || !Array.isArray(resp.response.view) ||\n          resp.response.view.length < 1\n        ) {\n          return;\n        }\n\n        const view = resp.response.view[0];\n        if (!Array.isArray(view.result) || view.result.length < 1) {\n          return;\n        }\n\n        const result = view.result[0];\n        const coordinates = [\n          result.location.displayPosition.latitude,\n          result.location.displayPosition.longitude\n        ];\n\n        $input.trigger(\n          \"geocoder-suggest-coordinates.decidim\",\n          [coordinates]\n        );\n      });\n    });\n  })\n})\n"]},"metadata":{},"sourceType":"module"}