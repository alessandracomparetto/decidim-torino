{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n$(function () {\n  var $multipleMentionContainer = $(\".js-multiple-mentions\");\n  var $multipleMentionRecipientsContainer = $(\".js-multiple-mentions-recipients\");\n  var nodatafound = $multipleMentionContainer.attr(\"data-noresults\");\n  var directMessageDisabled = $multipleMentionContainer.attr(\"data-direct-messages-disabled\");\n  var maxRecipients = 9;\n  var mentionsCount = 0;\n  /* eslint no-unused-vars: 0 */\n\n  var deleteRecipient = function deleteRecipient(element) {\n    // Remove recipient\n    element.remove();\n    mentionsCount -= 1; // In case mentions container disable, enable again\n\n    if ($multipleMentionContainer.prop(\"disabled\")) {\n      $multipleMentionContainer.prop(\"disabled\", false);\n    }\n  };\n\n  var noMatchTemplate = null;\n\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  } // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n\n  /* eslint no-invalid-this: 0 */\n\n  /* eslint consistent-this: 0 */\n\n  /* eslint prefer-reflect: 0 */\n\n\n  var debounce = function debounce(callback, wait) {\n    var _this = this;\n\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var context = _this;\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        return callback.apply(context, args);\n      }, wait);\n    };\n  };\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n\n  /* eslint no-unused-expressions: 0 */\n\n\n  var remoteSearch = function remoteSearch(text, cb) {\n    var exclusionIds = [];\n    $multipleMentionRecipientsContainer.find(\"input[name^='recipient_id']\").each(function (index) {\n      exclusionIds.push($(this).val());\n    });\n    var query = \"{users(filter:{wildcard:\\\"\".concat(text, \"\\\",excludeIds:[\").concat(exclusionIds, \"]}){id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{directMessagesEnabled}}}\");\n    $.post(\"/api\", {\n      query: query\n    }).then(function (response) {\n      var data = response.data.users || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\"); // We need to move the container to the wrapper selected\n\n      var $tribute = $parent.find(\".tribute-container\"); // Remove the inline styles, relative to absolute positioning\n\n      $tribute.removeAttr(\"style\");\n    });\n  }; // tribute.js docs - http://github.com/zurb/tribute\n\n  /* global Tribute*/\n\n  /* eslint multiline-ternary: 0 */\n\n  /* eslint no-ternary: 0 */\n\n\n  var tribute = new Tribute({\n    autocompleteMode: true,\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, function (users) {\n        return cb(users);\n      });\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    menuItemLimit: 10,\n    fillAttr: \"nickname\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.nickname + item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      mentionsCount += 1;\n\n      if (mentionsCount >= maxRecipients) {\n        $multipleMentionContainer.prop(\"disabled\", true);\n      }\n\n      if (typeof item === \"undefined\") {\n        return null;\n      } // Set recipient profile view\n\n\n      var recipientLabel = \"\\n        <label style=\\\"padding: 0 0 10px 0\\\">\\n          <img src=\\\"\".concat(item.original.avatarUrl, \"\\\" alt=\\\"\").concat(item.original.name, \"\\\" height=\\\"35\\\" width=\\\"35\\\" style=\\\"border-radius: 50%;\\\" aria-label=\\\"\").concat(item.original.name, \"\\\">&nbsp;\\n          <b>\").concat(item.original.name, \"</b>\\n          <input type=\\\"hidden\\\" name=\\\"recipient_id[]\\\" value=\\\"\").concat(item.original.id, \"\\\">\\n          <div class=\\\"float-right\\\">&times;</div>\\n        </label>\\n      \"); // Append new recipient to DOM\n\n      if (item.original.__typename === \"UserGroup\" || item.original.directMessagesEnabled === \"true\") {\n        $multipleMentionRecipientsContainer.append($(recipientLabel));\n        $multipleMentionContainer.val(\"\");\n      } // In order to add tabindex accessibility control to each recipient in list\n\n\n      $multipleMentionRecipientsContainer.find(\"label\").each(function (index) {\n        $(this).find(\"div\").attr(\"tabIndex\", 0).attr(\"aria-controls\", 0).attr(\"aria-label\", \"Close\").attr(\"role\", \"tab\");\n      }); // Clean input\n\n      return \"\";\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var svg = \"\";\n      var enabled = item.original.directMessagesEnabled === \"true\";\n\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        enabled = true;\n        var iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = \"<span class=\\\"is-group\\\">\".concat(item.original.membersCount, \"x <svg class=\\\"icon--members icon\\\"><use href=\\\"\").concat(iconsPath, \"#icon-members\\\"/></svg></span>\");\n      }\n\n      var disabledElementClass = enabled ? \"\" : \"disabled-tribute-element\";\n      var disabledElementMessage = enabled ? \"\" : \"&nbsp;<span class=\\\"disabled-tribute-element-info\\\">\".concat(directMessageDisabled, \"</span>\");\n      return \"<div class=\\\"tribute-item \".concat(item.original.__typename, \" \").concat(disabledElementClass, \"\\\">\\n      <span class=\\\"author__avatar\\\"><img src=\\\"\").concat(item.original.avatarUrl, \"\\\" alt=\\\"author-avatar\\\"></span>\\n        <strong>\").concat(item.original.nickname, \"</strong>\\n        <small>\").concat(item.original.name, \"</small>\\n        \").concat(svg, \"\\n        \").concat(disabledElementMessage, \"\\n      </div>\");\n    }\n  });\n\n  var setupEvents = function setupEvents($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", function (event) {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        var $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent); // Remove the inline styles, relative to absolute positioning\n\n        $tribute.removeAttr(\"style\"); // Parent adaptation\n\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  var setupRecipientEvents = function setupRecipientEvents($element) {\n    // Allow delete with click on element in recipients list\n    $element.on(\"click\", function (event) {\n      var $target = event.target.parentNode;\n\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n      }\n    }); // Allow delete with keypress on element in recipients list\n\n    $element.on(\"keypress\", function (event) {\n      var $target = event.target.parentNode;\n\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n      }\n    });\n  }; // Call only if we have containter to bind events to\n\n\n  if ($multipleMentionContainer.length) {\n    setupEvents($multipleMentionContainer);\n    tribute.attach($multipleMentionContainer);\n  } // Call only if we have containter to bind events to\n\n\n  if ($multipleMentionRecipientsContainer.length) {\n    setupRecipientEvents($multipleMentionRecipientsContainer);\n  }\n});","map":{"version":3,"mappings":"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","names":["Tribute","$","$multipleMentionContainer","$multipleMentionRecipientsContainer","nodatafound","attr","directMessageDisabled","maxRecipients","mentionsCount","deleteRecipient","element","remove","prop","noMatchTemplate","debounce","callback","wait","timeout","args","arguments","context","_this","clearTimeout","setTimeout","apply","remoteSearch","text","cb","exclusionIds","find","each","index","push","val","query","post","then","response","data","users","fail","always","$parent","tribute","current","parent","addClass","$tribute","removeAttr","autocompleteMode","values","positionMenu","menuContainer","menuItemLimit","fillAttr","lookup","item","nickname","name","selectTemplate","recipientLabel","original","avatarUrl","id","__typename","directMessagesEnabled","append","menuItemTemplate","svg","enabled","window","Decidim","iconsPath","config","get","membersCount","disabledElementClass","disabledElementMessage","setupEvents","$element","on","event","target","parentNode","hasClass","removeClass","isActive","appendTo","setupRecipientEvents","$target","tagName","length","attach"],"sources":["/var/lib/gems/2.7.0/gems/decidim-core-0.26.0/app/packs/src/decidim/input_multiple_mentions.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\n$(() => {\n  const $multipleMentionContainer = $(\".js-multiple-mentions\");\n  const $multipleMentionRecipientsContainer = $(\".js-multiple-mentions-recipients\");\n  const nodatafound = $multipleMentionContainer.attr(\"data-noresults\");\n  const directMessageDisabled = $multipleMentionContainer.attr(\"data-direct-messages-disabled\");\n\n  const maxRecipients = 9;\n  let mentionsCount = 0;\n\n  /* eslint no-unused-vars: 0 */\n  let deleteRecipient = function(element) {\n    // Remove recipient\n    element.remove();\n    mentionsCount -= 1;\n    // In case mentions container disable, enable again\n    if ($multipleMentionContainer.prop(\"disabled\")) {\n      $multipleMentionContainer.prop(\"disabled\", false);\n    }\n  };\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n  /* eslint no-invalid-this: 0 */\n  /* eslint consistent-this: 0 */\n  /* eslint prefer-reflect: 0 */\n  const debounce = function(callback, wait) {\n    let timeout = null;\n    return (...args) => {\n      const context = this;\n      clearTimeout(timeout);\n      timeout = setTimeout(() => callback.apply(context, args), wait);\n    };\n  }\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  /* eslint no-unused-expressions: 0 */\n  let remoteSearch = function(text, cb) {\n    let exclusionIds = [];\n    $multipleMentionRecipientsContainer.find(\"input[name^='recipient_id']\").each(function(index) {\n      exclusionIds.push($(this).val());\n    });\n    let query = `{users(filter:{wildcard:\"${text}\",excludeIds:[${exclusionIds}]}){id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{directMessagesEnabled}}}`;\n    $.post(\"/api\", {query: query}).\n      then((response) => {\n        let data = response.data.users || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent();\n        $parent.addClass(\"is-active\");\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  /* eslint multiline-ternary: 0 */\n  /* eslint no-ternary: 0 */\n  let tribute = new Tribute({\n    autocompleteMode: true,\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, (users) => cb(users));\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    menuItemLimit: 10,\n    fillAttr: \"nickname\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.nickname + item.name,\n    selectTemplate: function(item) {\n      mentionsCount += 1;\n      if (mentionsCount >= maxRecipients) {\n        $multipleMentionContainer.prop(\"disabled\", true);\n      }\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      // Set recipient profile view\n      let recipientLabel = `\n        <label style=\"padding: 0 0 10px 0\">\n          <img src=\"${item.original.avatarUrl}\" alt=\"${item.original.name}\" height=\"35\" width=\"35\" style=\"border-radius: 50%;\" aria-label=\"${item.original.name}\">&nbsp;\n          <b>${item.original.name}</b>\n          <input type=\"hidden\" name=\"recipient_id[]\" value=\"${item.original.id}\">\n          <div class=\"float-right\">&times;</div>\n        </label>\n      `;\n\n      // Append new recipient to DOM\n      if (item.original.__typename === \"UserGroup\" || item.original.directMessagesEnabled === \"true\") {\n        $multipleMentionRecipientsContainer.append($(recipientLabel));\n        $multipleMentionContainer.val(\"\");\n      }\n\n      // In order to add tabindex accessibility control to each recipient in list\n      $multipleMentionRecipientsContainer.find(\"label\").each(function(index) {\n        $(this).find(\"div\").attr(\"tabIndex\", 0).attr(\"aria-controls\", 0).attr(\"aria-label\", \"Close\").attr(\"role\", \"tab\");\n      });\n\n      // Clean input\n      return \"\";\n    },\n    menuItemTemplate: function(item) {\n      let svg = \"\";\n      let enabled = item.original.directMessagesEnabled === \"true\";\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        enabled = true;\n        const iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = `<span class=\"is-group\">${item.original.membersCount}x <svg class=\"icon--members icon\"><use href=\"${iconsPath}#icon-members\"/></svg></span>`;\n      }\n      let disabledElementClass = enabled ? \"\" : \"disabled-tribute-element\";\n      let disabledElementMessage = enabled ? \"\" : `&nbsp;<span class=\"disabled-tribute-element-info\">${directMessageDisabled}</span>`;\n      return `<div class=\"tribute-item ${item.original.__typename} ${disabledElementClass}\">\n      <span class=\"author__avatar\"><img src=\"${item.original.avatarUrl}\" alt=\"author-avatar\"></span>\n        <strong>${item.original.nickname}</strong>\n        <small>${item.original.name}</small>\n        ${svg}\n        ${disabledElementMessage}\n      </div>`;\n    }\n  });\n\n  let setupEvents = function($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", (event) => {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        let $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent);\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n        // Parent adaptation\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  let setupRecipientEvents = function($element) {\n    // Allow delete with click on element in recipients list\n    $element.on(\"click\", (event) => {\n      let $target = event.target.parentNode;\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n      }\n    });\n    // Allow delete with keypress on element in recipients list\n    $element.on(\"keypress\", (event) => {\n      let $target = event.target.parentNode;\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n      }\n    });\n  };\n\n  // Call only if we have containter to bind events to\n  if ($multipleMentionContainer.length) {\n    setupEvents($multipleMentionContainer);\n    tribute.attach($multipleMentionContainer);\n  }\n\n  // Call only if we have containter to bind events to\n  if ($multipleMentionRecipientsContainer.length) {\n    setupRecipientEvents($multipleMentionRecipientsContainer);\n  }\n});\n"]},"metadata":{},"sourceType":"module"}