{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n$(function () {\n  var $mentionContainer = $(\".js-mentions\");\n  var nodatafound = $mentionContainer.attr(\"data-noresults\");\n  var noMatchTemplate = null;\n\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  } // Listener for the event triggered by quilljs\n\n\n  var cursor = \"\";\n  $mentionContainer.on(\"quill-position\", function (event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      var quill = event.target.__quill;\n\n      if (quill.getText(event.detail.index - 1, 1) === \"@\") {\n        cursor = event.detail.index;\n      }\n    }\n  }); // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n\n  /* eslint no-invalid-this: 0 */\n\n  /* eslint consistent-this: 0 */\n\n  /* eslint prefer-reflect: 0 */\n\n  var debounce = function debounce(callback, wait) {\n    var _this = this;\n\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var context = _this;\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        return callback.apply(context, args);\n      }, wait);\n    };\n  };\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n\n\n  var remoteSearch = function remoteSearch(text, cb) {\n    var query = \"{users(filter:{wildcard:\\\"\".concat(text, \"\\\"}){nickname,name,avatarUrl,__typename,...on UserGroup{membersCount}}}\");\n    $.post(\"/api\", {\n      query: query\n    }).then(function (response) {\n      var data = response.data.users || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\"); // We need to move the container to the wrapper selected\n\n      var $tribute = $parent.find(\".tribute-container\"); // Remove the inline styles, relative to absolute positioning\n\n      $tribute.removeAttr(\"style\");\n    });\n  }; // tribute.js docs - http://github.com/zurb/tribute\n\n  /* global Tribute*/\n\n\n  var tribute = new Tribute({\n    trigger: \"@\",\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, function (users) {\n        return cb(users);\n      });\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    allowSpaces: true,\n    menuItemLimit: 5,\n    fillAttr: \"nickname\",\n    selectClass: \"highlight\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.nickname + item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          var editorContainer = $(this.current.element).parent().get(0);\n          var quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, \"\".concat(item.original.nickname, \" \"), Quill.sources.API); // cursor position + nickname length + \"@\" sign + space\n\n          var position = cursor + item.original.nickname.length + 2;\n          var next = 0;\n\n          if (quill.getLength() > position) {\n            next = position;\n          } else {\n            next = quill.getLength() - 1;\n          } // Workaround https://github.com/quilljs/quill/issues/731\n\n\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n          return \"\";\n        }\n\n        return \"<span contenteditable=\\\"false\\\">\".concat(item.original.nickname, \"</span>\");\n      }\n\n      return item.original.nickname;\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var svg = \"\";\n\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        var iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = \"<span class=\\\"is-group\\\">\".concat(item.original.membersCount, \"x <svg class=\\\"icon--members icon\\\"><use href=\\\"\").concat(iconsPath, \"#icon-members\\\"/></svg></span>\");\n      }\n\n      return \"<div class=\\\"tribute-item \".concat(item.original.__typename, \"\\\">\\n      <span class=\\\"author__avatar\\\"><img src=\\\"\").concat(item.original.avatarUrl, \"\\\" alt=\\\"author-avatar\\\"></span>\\n        <strong>\").concat(item.original.nickname, \"</strong>\\n        <small>\").concat(item.original.name, \"</small>\\n        \").concat(svg, \"\\n      </div>\");\n    }\n  });\n\n  var setupEvents = function setupEvents($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", function (event) {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        var $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent); // Parent adaptation\n\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  setupEvents($mentionContainer); // This allows external libraries (like React) to use the component\n  // by simply firing and event targeting the element where to attach Tribute\n\n  $(document).on(\"attach-mentions-element\", function (event, element) {\n    if (!element) {\n      return;\n    }\n\n    tribute.attach(element); // Due a bug in Tribute, re-add menu to DOM if it has been removed\n    // See https://github.com/zurb/tribute/issues/140\n\n    if (tribute.menu && !document.body.contains(tribute.menu)) {\n      tribute.range.getDocument().body.appendChild(tribute.menu);\n    }\n\n    setupEvents($(element));\n  }); // tribute.attach($mentionContainer);\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n\n  setTimeout(function () {\n    $mentionContainer.each(function (index, item) {\n      var $qlEditor = $(\".ql-editor\", item);\n\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n});","map":{"version":3,"mappings":"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","names":["Tribute","$","$mentionContainer","nodatafound","attr","noMatchTemplate","cursor","on","event","detail","quill","target","__quill","getText","index","debounce","callback","wait","timeout","args","arguments","context","_this","clearTimeout","setTimeout","apply","remoteSearch","text","cb","query","post","then","response","data","users","fail","always","$parent","tribute","current","element","parent","addClass","$tribute","find","removeAttr","trigger","values","positionMenu","menuContainer","allowSpaces","menuItemLimit","fillAttr","selectClass","lookup","item","nickname","name","selectTemplate","range","isContentEditable","hasClass","editorContainer","get","insertText","original","Quill","sources","API","position","length","next","getLength","setSelection","menuItemTemplate","svg","window","Decidim","__typename","iconsPath","config","membersCount","avatarUrl","setupEvents","$element","parentNode","removeClass","isActive","appendTo","document","attach","menu","body","contains","getDocument","appendChild","each","$qlEditor"],"sources":["/var/lib/gems/2.7.0/gems/decidim-core-0.26.0/app/packs/src/decidim/input_mentions.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\n$(() => {\n  const $mentionContainer = $(\".js-mentions\");\n  const nodatafound = $mentionContainer.attr(\"data-noresults\");\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Listener for the event triggered by quilljs\n  let cursor = \"\";\n  $mentionContainer.on(\"quill-position\", (event) => {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      let quill = event.target.__quill;\n      if (quill.getText(event.detail.index - 1, 1) === \"@\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n  /* eslint no-invalid-this: 0 */\n  /* eslint consistent-this: 0 */\n  /* eslint prefer-reflect: 0 */\n  const debounce = function(callback, wait) {\n    let timeout = null;\n    return (...args) => {\n      const context = this;\n      clearTimeout(timeout);\n      timeout = setTimeout(() => callback.apply(context, args), wait);\n    };\n  }\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  let remoteSearch = function(text, cb) {\n    let query = `{users(filter:{wildcard:\"${text}\"}){nickname,name,avatarUrl,__typename,...on UserGroup{membersCount}}}`;\n    $.post(\"/api\", {query: query}).\n      then((response) => {\n        let data = response.data.users || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent();\n        $parent.addClass(\"is-active\");\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  let tribute = new Tribute({\n    trigger: \"@\",\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, (users) => cb(users));\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    allowSpaces: true,\n    menuItemLimit: 5,\n    fillAttr: \"nickname\",\n    selectClass: \"highlight\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.nickname + item.name,\n    selectTemplate: function(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          let editorContainer = $(this.current.element).parent().get(0);\n          let quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, `${item.original.nickname} `, Quill.sources.API);\n          // cursor position + nickname length + \"@\" sign + space\n          let position = cursor + item.original.nickname.length + 2\n\n          let next = 0;\n          if (quill.getLength() > position) {\n            next = position\n          } else {\n            next = quill.getLength() - 1\n          }\n          // Workaround https://github.com/quilljs/quill/issues/731\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n\n          return \"\"\n        }\n        return `<span contenteditable=\"false\">${item.original.nickname}</span>`;\n      }\n      return item.original.nickname;\n    },\n    menuItemTemplate: function(item) {\n      let svg = \"\";\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        const iconsPath =  window.Decidim.config.get(\"icons_path\");\n\n        svg = `<span class=\"is-group\">${item.original.membersCount}x <svg class=\"icon--members icon\"><use href=\"${iconsPath}#icon-members\"/></svg></span>`;\n      }\n      return `<div class=\"tribute-item ${item.original.__typename}\">\n      <span class=\"author__avatar\"><img src=\"${item.original.avatarUrl}\" alt=\"author-avatar\"></span>\n        <strong>${item.original.nickname}</strong>\n        <small>${item.original.name}</small>\n        ${svg}\n      </div>`;\n    }\n  });\n\n  let setupEvents = function($element) {\n    // DOM manipulation\n    $element.on(\"focusin\", (event) => {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        let $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent);\n\n        // Parent adaptation\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  setupEvents($mentionContainer);\n\n  // This allows external libraries (like React) to use the component\n  // by simply firing and event targeting the element where to attach Tribute\n  $(document).on(\"attach-mentions-element\", (event, element) => {\n    if (!element) {\n      return;\n    }\n    tribute.attach(element);\n    // Due a bug in Tribute, re-add menu to DOM if it has been removed\n    // See https://github.com/zurb/tribute/issues/140\n    if (tribute.menu && !document.body.contains(tribute.menu)) {\n      tribute.range.getDocument().body.appendChild(tribute.menu);\n    }\n    setupEvents($(element));\n  });\n\n  // tribute.attach($mentionContainer);\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n  setTimeout(function() {\n    $mentionContainer.each((index, item) => {\n      let $qlEditor = $(\".ql-editor\", item);\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n});\n\n"]},"metadata":{},"sourceType":"module"}