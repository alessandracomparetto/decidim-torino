{"ast":null,"code":"import \"src/decidim/geocoding\";\nimport formatAddress from \"src/decidim/geocoding/format_address\";\n/**\n * For the available address format keys, refer to:\n * https://github.com/komoot/photon\n */\n\n$(function () {\n  var generateAddressLabel = formatAddress;\n  $(\"[data-decidim-geocoding]\").each(function (_i, el) {\n    var $input = $(el);\n    var config = $input.data(\"decidim-geocoding\");\n    var queryMinLength = config.queryMinLength || 2; // Default Photon installation only supports these languages but for\n    // custom instances, you can configure the supported languages.\n\n    var supportedLanguages = config.supportedLanguages || [\"de\", \"en\", \"it\", \"fr\"];\n    var defaultLanguage = config.defaultLanguage || \"en\";\n    var addressFormat = config.addressFormat || [\"name\", [\"street\", \"housenumber\"], \"postcode\", \"city\", \"state\", \"country\"];\n    var language = $(\"html\").attr(\"lang\");\n\n    if (!supportedLanguages.includes(language)) {\n      language = defaultLanguage;\n    }\n\n    var currentSuggestionQuery = null;\n\n    if (!config.url || config.url.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", function (_ev, query, callback) {\n      clearTimeout(currentSuggestionQuery); // Do not trigger API calls on short queries\n\n      if (\"\".concat(query).trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(function () {\n        $.ajax({\n          method: \"GET\",\n          url: config.url,\n          data: {\n            q: query,\n            // eslint-disable-line\n            lang: language\n          },\n          dataType: \"json\"\n        }).done(function (resp) {\n          if (resp.features) {\n            return callback(resp.features.map(function (item) {\n              var label = generateAddressLabel(item.properties, addressFormat);\n              return {\n                key: label,\n                value: label,\n                coordinates: item.geometry.coordinates\n              };\n            }));\n          }\n\n          return null;\n        });\n      }, 200);\n    });\n  });\n});","map":{"version":3,"mappings":"AAAA,OAAO,uBAAP;AACA,OAAOA,aAAP,MAA0B,sCAA1B;AAEA;AACA;AACA;AACA;;AACAC,CAAC,CAAC,YAAM;AACN,MAAMC,oBAAoB,GAAGF,aAA7B;AAEAC,GAAC,CAAC,0BAAD,CAADA,CAA8BE,IAA9BF,CAAmC,UAACG,EAAD,EAAKC,EAAL,EAAY;AAC7C,QAAMC,MAAM,GAAGL,CAAC,CAACI,EAAD,CAAhB;AACA,QAAME,MAAM,GAAGD,MAAM,CAACE,IAAPF,CAAY,mBAAZA,CAAf;AACA,QAAMG,cAAc,GAAGF,MAAM,CAACE,cAAPF,IAAyB,CAAhD,CAH6C,CAI7C;AACA;;AACA,QAAMG,kBAAkB,GAAGH,MAAM,CAACG,kBAAPH,IAA6B,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,CAAxD;AACA,QAAMI,eAAe,GAAIJ,MAAM,CAACI,eAAPJ,IAA0B,IAAnD;AACA,QAAMK,aAAa,GAAGL,MAAM,CAACK,aAAPL,IAAwB,CAC5C,MAD4C,EAE5C,CAAC,QAAD,EAAW,aAAX,CAF4C,EAG5C,UAH4C,EAI5C,MAJ4C,EAK5C,OAL4C,EAM5C,SAN4C,CAA9C;AAQA,QAAIM,QAAQ,GAAGZ,CAAC,CAAC,MAAD,CAADA,CAAUa,IAAVb,CAAe,MAAfA,CAAf;;AACA,QAAI,CAACS,kBAAkB,CAACK,QAAnBL,CAA4BG,QAA5BH,CAAL,EAA4C;AAC1CG,cAAQ,GAAGF,eAAXE;AACD;;AACD,QAAIG,sBAAsB,GAAG,IAA7B;;AAEA,QAAI,CAACT,MAAM,CAACU,GAAR,IAAeV,MAAM,CAACU,GAAPV,CAAWW,MAAXX,GAAoB,CAAvC,EAA0C;AACxC;AACD;;AAEDD,UAAM,CAACa,EAAPb,CAAU,0BAAVA,EAAsC,UAACc,GAAD,EAAMC,KAAN,EAAaC,QAAb,EAA0B;AAC9DC,kBAAY,CAACP,sBAAD,CAAZO,CAD8D,CAG9D;;AACA,UAAI,UAAGF,KAAH,EAAWG,IAAX,GAAkBN,MAAlB,GAA2BT,cAA/B,EAA+C;AAC7C;AACD;;AAEDO,4BAAsB,GAAGS,UAAU,CAAC,YAAM;AACxCxB,SAAC,CAACyB,IAAFzB,CAAO;AACL0B,gBAAM,EAAE,KADH;AAELV,aAAG,EAAEV,MAAM,CAACU,GAFP;AAGLT,cAAI,EAAE;AACJoB,aAAC,EAAEP,KADC;AACM;AACVQ,gBAAI,EAAEhB;AAFF,WAHD;AAOLiB,kBAAQ,EAAE;AAPL,SAAP7B,EAQG8B,IARH9B,CAQQ,UAAC+B,IAAD,EAAU;AAChB,cAAIA,IAAI,CAACC,QAAT,EAAmB;AACjB,mBAAOX,QAAQ,CAACU,IAAI,CAACC,QAALD,CAAcE,GAAdF,CAAkB,UAACG,IAAD,EAAU;AAC1C,kBAAMC,KAAK,GAAGlC,oBAAoB,CAACiC,IAAI,CAACE,UAAN,EAAkBzB,aAAlB,CAAlC;AAEA,qBAAO;AACL0B,mBAAG,EAAEF,KADA;AAELG,qBAAK,EAAEH,KAFF;AAGLI,2BAAW,EAAEL,IAAI,CAACM,QAALN,CAAcK;AAHtB,eAAP;AAHc,cAAD,CAAf;AASD;;AACD,iBAAO,IAAP;AApBF;AADiC,SAuBhC,GAvBgC,CAAnCxB;AARF;AA1BF;AAHD,EAADf","names":["formatAddress","$","generateAddressLabel","each","_i","el","$input","config","data","queryMinLength","supportedLanguages","defaultLanguage","addressFormat","language","attr","includes","currentSuggestionQuery","url","length","on","_ev","query","callback","clearTimeout","trim","setTimeout","ajax","method","q","lang","dataType","done","resp","features","map","item","label","properties","key","value","coordinates","geometry"],"sources":["/var/lib/gems/2.7.0/gems/decidim-core-0.26.0/app/packs/src/decidim/geocoding/provider/photon.js"],"sourcesContent":["import \"src/decidim/geocoding\"\nimport formatAddress from \"src/decidim/geocoding/format_address\"\n\n/**\n * For the available address format keys, refer to:\n * https://github.com/komoot/photon\n */\n$(() => {\n  const generateAddressLabel = formatAddress;\n\n  $(\"[data-decidim-geocoding]\").each((_i, el) => {\n    const $input = $(el);\n    const config = $input.data(\"decidim-geocoding\");\n    const queryMinLength = config.queryMinLength || 2;\n    // Default Photon installation only supports these languages but for\n    // custom instances, you can configure the supported languages.\n    const supportedLanguages = config.supportedLanguages || [\"de\", \"en\", \"it\", \"fr\"];\n    const defaultLanguage  = config.defaultLanguage || \"en\";\n    const addressFormat = config.addressFormat || [\n      \"name\",\n      [\"street\", \"housenumber\"],\n      \"postcode\",\n      \"city\",\n      \"state\",\n      \"country\"\n    ];\n    let language = $(\"html\").attr(\"lang\");\n    if (!supportedLanguages.includes(language)) {\n      language = defaultLanguage;\n    }\n    let currentSuggestionQuery = null;\n\n    if (!config.url || config.url.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", (_ev, query, callback) => {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (`${query}`.trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(() => {\n        $.ajax({\n          method: \"GET\",\n          url: config.url,\n          data: {\n            q: query, // eslint-disable-line\n            lang: language\n          },\n          dataType: \"json\"\n        }).done((resp) => {\n          if (resp.features) {\n            return callback(resp.features.map((item) => {\n              const label = generateAddressLabel(item.properties, addressFormat);\n\n              return {\n                key: label,\n                value: label,\n                coordinates: item.geometry.coordinates\n              }\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n  })\n});\n"]},"metadata":{},"sourceType":"module"}