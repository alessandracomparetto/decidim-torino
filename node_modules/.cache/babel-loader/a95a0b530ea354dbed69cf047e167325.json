{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nvar DataPicker = /*#__PURE__*/function () {\n  function DataPicker(pickers) {\n    var _this = this;\n\n    _classCallCheck(this, DataPicker);\n\n    this.modal = this._createModalContainer();\n    this.modal.appendTo($(\"body\"));\n    this.current = null;\n    pickers.each(function (_index, picker) {\n      _this.activate(picker);\n    });\n  }\n\n  _createClass(DataPicker, [{\n    key: \"activate\",\n    value: function activate(picker) {\n      var _this2 = this;\n\n      var $picker = $(picker);\n\n      this._setCurrentPicker($picker, null);\n\n      var input = \"hidden\",\n          name = this.current.name,\n          values = this.current.values;\n\n      if (this.current.multiple) {\n        name += \"[]\";\n      }\n\n      $(\"div\", values).each(function (_index2, div) {\n        var value = $(\"a\", div).data(\"picker-value\");\n        $(div).prepend($(\"<input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\" value=\\\"\").concat(value, \"\\\"/>\")));\n      });\n      $picker.on(\"click\", \"a\", function (event) {\n        event.preventDefault();\n\n        if ($picker.hasClass(\"disabled\")) {\n          return;\n        }\n\n        var isMultiPicker = $picker.hasClass(\"picker-multiple\");\n\n        if ($(_this2._targetFromEvent(event)).hasClass(\"picker-prompt\") || !isMultiPicker) {\n          _this2._openPicker($picker, _this2._targetFromEvent(event));\n        } else if (_this2._targetFromEvent(event).tagName === \"A\") {\n          _this2._removeValue($picker, _this2._targetFromEvent(event).parentNode);\n        } else {\n          _this2._removeValue($picker, _this2._targetFromEvent(event));\n        }\n      });\n      $picker.on(\"click\", \"input\", function (event) {\n        _this2._removeValue($picker, _this2._targetFromEvent(event));\n      });\n\n      if (this.current.autosort) {\n        this._sort();\n      }\n    }\n  }, {\n    key: \"enabled\",\n    value: function enabled(picker, value) {\n      $(picker).toggleClass(\"disabled\", !value);\n      $(\"input\", picker).attr(\"disabled\", !value);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear(picker) {\n      $(\".picker-values\", picker).html(\"\");\n    }\n  }, {\n    key: \"save\",\n    value: function save(picker) {\n      return $(\".picker-values div:has(input:checked)\", picker).map(function (_index, div) {\n        var $link = $(\"a\", div);\n        return {\n          value: $(\"input\", div).val(),\n          text: $link.text(),\n          url: $link.attr(\"href\")\n        };\n      }).get();\n    }\n  }, {\n    key: \"load\",\n    value: function load(picker, savedData) {\n      var _this3 = this;\n\n      this._setCurrentPicker($(picker), null);\n\n      $.each(savedData, function (_index, data) {\n        _this3._choose(data, {\n          interactive: false,\n          modify: false\n        });\n      });\n\n      if (this.current.autosort) {\n        this._sort();\n      }\n    }\n  }, {\n    key: \"_createModalContainer\",\n    value: function _createModalContainer() {\n      // Add a header because we are referencing the title element with\n      // `aria-labelledby`. If the title doesn't exist, the \"labelled by\"\n      // reference is incorrect.\n      var headerHtml = '<div class=\"scope-picker picker-header\"><h6 id=\"data_picker-title\" class=\"h2\"></h6></div>';\n      return $(\"<div class=\\\"small reveal\\\" id=\\\"data_picker-modal\\\" aria-hidden=\\\"true\\\" aria-live=\\\"assertive\\\" role=\\\"dialog\\\" aria-labelledby=\\\"data_picker-title\\\" data-reveal data-multiple-opened=\\\"true\\\">\\n             <div class=\\\"data_picker-modal-content\\\">\".concat(headerHtml, \"</div>\\n             <button class=\\\"close-button\\\" data-close type=\\\"button\\\" data-reveal-id=\\\"data_picker-modal\\\"><span aria-hidden=\\\"true\\\">&times;</span></button>\\n             </div>\"));\n    }\n  }, {\n    key: \"_openPicker\",\n    value: function _openPicker($picker, target) {\n      this._setCurrentPicker($picker, target);\n\n      this._load($(\"a\", target).attr(\"href\"));\n    }\n  }, {\n    key: \"_setCurrentPicker\",\n    value: function _setCurrentPicker($picker, target) {\n      var $target = false;\n\n      if (target && !$(target).hasClass(\"picker-prompt\")) {\n        $target = $(target);\n      }\n\n      this.current = {\n        picker: $picker,\n        name: $picker.data(\"picker-name\"),\n        values: $picker.find(\".picker-values\"),\n        multiple: $picker.hasClass(\"picker-multiple\"),\n        autosort: $picker.hasClass(\"picker-multiple\") && $picker.hasClass(\"picker-autosort\"),\n        target: $target\n      };\n    }\n  }, {\n    key: \"_load\",\n    value: function _load(url) {\n      var _this4 = this;\n\n      $.ajax(url).done(function (resp) {\n        var modalContent = $(\".data_picker-modal-content\", _this4.modal);\n        modalContent.html(resp);\n\n        _this4._handleLinks(modalContent);\n\n        _this4._handleCheckboxes(modalContent);\n\n        _this4.modal.foundation(\"open\");\n      });\n    }\n  }, {\n    key: \"_handleLinks\",\n    value: function _handleLinks(content) {\n      var _this5 = this;\n\n      $(\"a\", content).each(function (_index, link) {\n        var $link = $(link);\n        $link.click(function (event) {\n          event.preventDefault();\n\n          if ($link.data(\"close\") || $link.data(\"close\") === \"\") {\n            return;\n          }\n\n          var chooseUrl = $link.attr(\"href\");\n\n          if (chooseUrl) {\n            if (typeof $link.data(\"picker-choose\") === \"undefined\") {\n              _this5._load(chooseUrl);\n            } else {\n              _this5._choose({\n                url: chooseUrl,\n                value: $link.data(\"picker-value\") || \"\",\n                text: $link.data(\"picker-text\") || \"\"\n              });\n            }\n          }\n        });\n      });\n    }\n  }, {\n    key: \"_handleCheckboxes\",\n    value: function _handleCheckboxes(content) {\n      var _this6 = this;\n\n      $(\"input[type=checkbox][data-picker-choose]\", content).each(function (_index, checkbox) {\n        var $checkbox = $(checkbox);\n        checkbox.checked = _this6._targetFromValue($checkbox.val()) !== null;\n      }).change(function (event) {\n        var $checkbox = $(event.target);\n\n        if (event.target.checked) {\n          _this6._choose({\n            url: $checkbox.data(\"picker-url\"),\n            value: $checkbox.val() || \"\",\n            text: $checkbox.data(\"picker-text\") || \"\"\n          }, {\n            modify: false,\n            close: false\n          });\n        } else {\n          _this6._removeValue(_this6.current.picker, _this6._targetFromValue($checkbox.val()));\n        }\n      });\n    }\n  }, {\n    key: \"_choose\",\n    value: function _choose(data) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = Object.assign({\n        interactive: true,\n        modify: true,\n        close: true\n      }, opts);\n\n      var dataText = this._escape(data.text);\n\n      var choosenOption = null;\n\n      if (!this.current.target && options.modify) {\n        this.current.target = this._targetFromValue(data.value);\n      } // Add or update value appearance\n\n\n      if (this.current.target && options.modify) {\n        var link = $(\"a\", this.current.target);\n        link.data(\"picker-value\", data.value);\n        link.attr(\"href\", data.url);\n        choosenOption = this.current.target;\n\n        if (this.current.multiple) {\n          link.html(\"&times;&nbsp;\".concat(dataText));\n        } else {\n          link.text(dataText);\n        }\n      } else {\n        var input = \"hidden\",\n            name = this.current.name;\n\n        if (this.current.multiple) {\n          name += \"[]\";\n          choosenOption = $(\"<div><input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\"/><a href=\\\"\").concat(data.url, \"\\\" data-picker-value=\\\"\").concat(data.value, \"\\\" class=\\\"label primary\\\">&times;&nbsp;\").concat(dataText, \"</a></div>\"));\n        } else {\n          choosenOption = $(\"<div><input type=\\\"\".concat(input, \"\\\" checked name=\\\"\").concat(name, \"\\\"/><a href=\\\"\").concat(data.url, \"\\\" data-picker-value=\\\"\").concat(data.value, \"\\\">\").concat(dataText, \"</a></div>\"));\n        }\n\n        choosenOption.appendTo(this.current.values);\n\n        if (!this.current.target) {\n          this.current.target = choosenOption;\n        }\n      } // Set input value\n\n\n      var $input = $(\"input\", choosenOption);\n      $input.attr(\"value\", data.value);\n\n      if (this.current.autosort) {\n        this._sort();\n      }\n\n      if (options.interactive) {\n        // Raise changed event\n        $input.trigger(\"change\");\n\n        this._removeErrors();\n\n        if (options.close) {\n          this._close();\n        }\n      }\n    }\n  }, {\n    key: \"_sort\",\n    value: function _sort() {\n      var values = $(\".picker-values\", this.current.picker);\n      values.children().sort(function (item1, item2) {\n        return $(\"input\", item1).val() - $(\"input\", item2).val();\n      }).detach().appendTo(values);\n    }\n  }, {\n    key: \"_close\",\n    value: function _close() {\n      // Close modal and unset target element\n      this.modal.foundation(\"close\");\n      this.current.target = null;\n    }\n  }, {\n    key: \"_removeValue\",\n    value: function _removeValue($picker, target) {\n      var _this7 = this;\n\n      if (target) {\n        this._setCurrentPicker($picker, target); // Fadeout (with time) doesn't work in system tests\n\n\n        var fadeoutTime = 500;\n\n        if (navigator && navigator.webdriver) {\n          fadeoutTime = 0;\n        }\n\n        this.current.target.fadeOut(fadeoutTime, function () {\n          _this7.current.target.remove();\n\n          _this7.current.target = null;\n        });\n      }\n    }\n  }, {\n    key: \"_removeErrors\",\n    value: function _removeErrors() {\n      var parent = this.current.picker.parent();\n      $(\".is-invalid-input\", parent).removeClass(\"is-invalid-input\");\n      $(\".is-invalid-label\", parent).removeClass(\"is-invalid-label\");\n      $(\".form-error.is-visible\", parent).removeClass(\"is-visible\");\n    }\n  }, {\n    key: \"_escape\",\n    value: function _escape(str) {\n      return str.replace(/[\\u00A0-\\u9999<>&]/gim, function (_char) {\n        return \"&#\".concat(_char.charCodeAt(0), \";\");\n      });\n    }\n  }, {\n    key: \"_targetFromEvent\",\n    value: function _targetFromEvent(event) {\n      return event.target.parentNode;\n    }\n  }, {\n    key: \"_targetFromValue\",\n    value: function _targetFromValue(value) {\n      return $(\"[data-picker-value=\".concat(value, \"]\"), this.current.picker).parent()[0] || null;\n    }\n  }]);\n\n  return DataPicker;\n}();\n\nexport { DataPicker as default };","map":{"version":3,"mappings":"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","names":["DataPicker","pickers","_classCallCheck","modal","_createModalContainer","appendTo","$","current","each","_index","picker","_this","activate","$picker","_setCurrentPicker","input","name","values","multiple","_index2","div","value","data","prepend","on","event","preventDefault","hasClass","isMultiPicker","_this2","_targetFromEvent","_openPicker","tagName","_removeValue","parentNode","autosort","_sort","toggleClass","attr","html","map","$link","val","text","url","get","savedData","_this3","_choose","interactive","modify","headerHtml","target","_load","$target","find","ajax","done","resp","modalContent","_this4","_handleLinks","_handleCheckboxes","foundation","content","link","click","chooseUrl","_this5","checkbox","$checkbox","checked","_this6","_targetFromValue","change","close","opts","options","Object","assign","dataText","_escape","choosenOption","$input","trigger","_removeErrors","_close","children","sort","item1","item2","detach","fadeoutTime","navigator","webdriver","fadeOut","_this7","remove","parent","removeClass","str","replace","char","charCodeAt"],"sources":["/var/lib/gems/2.7.0/gems/decidim-core-0.26.0/app/packs/src/decidim/data_picker.js"],"sourcesContent":["export default class DataPicker {\n  constructor(pickers) {\n    this.modal = this._createModalContainer();\n    this.modal.appendTo($(\"body\"));\n    this.current = null;\n\n    pickers.each((_index, picker) => {\n      this.activate(picker);\n    });\n  }\n\n  activate(picker) {\n    let $picker = $(picker);\n\n    this._setCurrentPicker($picker, null);\n\n    let input = \"hidden\",\n        name = this.current.name,\n        values = this.current.values;\n\n    if (this.current.multiple) {\n      name += \"[]\";\n    }\n\n    $(\"div\", values).each((_index2, div) => {\n      let value = $(\"a\", div).data(\"picker-value\");\n      $(div).prepend($(`<input type=\"${input}\" checked name=\"${name}\" value=\"${value}\"/>`));\n    });\n\n    $picker.on(\"click\", \"a\", (event) => {\n      event.preventDefault();\n      if ($picker.hasClass(\"disabled\")) {\n        return;\n      }\n      const isMultiPicker = $picker.hasClass(\"picker-multiple\");\n\n      if ($(this._targetFromEvent(event)).hasClass(\"picker-prompt\") || !isMultiPicker) {\n        this._openPicker($picker, this._targetFromEvent(event));\n      }  else if (this._targetFromEvent(event).tagName === \"A\") {\n        this._removeValue($picker, this._targetFromEvent(event).parentNode);\n      } else {\n        this._removeValue($picker, this._targetFromEvent(event));\n      }\n    });\n\n    $picker.on(\"click\", \"input\", (event) => {\n      this._removeValue($picker, this._targetFromEvent(event));\n    });\n\n    if (this.current.autosort) {\n      this._sort();\n    }\n  }\n\n  enabled(picker, value) {\n    $(picker).toggleClass(\"disabled\", !value);\n    $(\"input\", picker).attr(\"disabled\", !value);\n  }\n\n  clear(picker) {\n    $(\".picker-values\", picker).html(\"\");\n  }\n\n  save(picker) {\n    return $(\".picker-values div:has(input:checked)\", picker).map((_index, div) => {\n      let $link = $(\"a\", div);\n      return {\n        value: $(\"input\", div).val(),\n        text: $link.text(),\n        url: $link.attr(\"href\")\n      };\n    }).get();\n  }\n\n  load(picker, savedData) {\n    this._setCurrentPicker($(picker), null);\n    $.each(savedData, (_index, data) => {\n      this._choose(data, { interactive: false, modify: false });\n    });\n    if (this.current.autosort) {\n      this._sort();\n    }\n  }\n\n  _createModalContainer() {\n    // Add a header because we are referencing the title element with\n    // `aria-labelledby`. If the title doesn't exist, the \"labelled by\"\n    // reference is incorrect.\n    const headerHtml = '<div class=\"scope-picker picker-header\"><h6 id=\"data_picker-title\" class=\"h2\"></h6></div>';\n\n    return $(`<div class=\"small reveal\" id=\"data_picker-modal\" aria-hidden=\"true\" aria-live=\"assertive\" role=\"dialog\" aria-labelledby=\"data_picker-title\" data-reveal data-multiple-opened=\"true\">\n             <div class=\"data_picker-modal-content\">${headerHtml}</div>\n             <button class=\"close-button\" data-close type=\"button\" data-reveal-id=\"data_picker-modal\"><span aria-hidden=\"true\">&times;</span></button>\n             </div>`);\n  }\n\n  _openPicker($picker, target) {\n    this._setCurrentPicker($picker, target);\n    this._load($(\"a\", target).attr(\"href\"));\n  }\n\n  _setCurrentPicker($picker, target) {\n    let $target = false;\n    if (target && !$(target).hasClass(\"picker-prompt\")) {\n      $target = $(target);\n    }\n\n    this.current = {\n      picker: $picker,\n      name: $picker.data(\"picker-name\"),\n      values: $picker.find(\".picker-values\"),\n      multiple: $picker.hasClass(\"picker-multiple\"),\n      autosort: $picker.hasClass(\"picker-multiple\") && $picker.hasClass(\"picker-autosort\"),\n      target: $target\n    };\n  }\n\n  _load(url) {\n    $.ajax(url).done((resp) => {\n      let modalContent = $(\".data_picker-modal-content\", this.modal);\n      modalContent.html(resp);\n      this._handleLinks(modalContent);\n      this._handleCheckboxes(modalContent);\n      this.modal.foundation(\"open\");\n    });\n  }\n\n  _handleLinks(content) {\n    $(\"a\", content).each((_index, link) => {\n      let $link = $(link);\n      $link.click((event) => {\n        event.preventDefault();\n        if ($link.data(\"close\") || $link.data(\"close\") === \"\") {\n          return;\n        }\n\n        let chooseUrl = $link.attr(\"href\");\n        if (chooseUrl) {\n          if (typeof $link.data(\"picker-choose\") === \"undefined\") {\n            this._load(chooseUrl);\n          } else {\n            this._choose(\n              { url: chooseUrl, value: $link.data(\"picker-value\") || \"\", text: $link.data(\"picker-text\") || \"\" }\n            );\n          }\n        }\n      });\n    });\n  }\n\n  _handleCheckboxes(content) {\n    $(\"input[type=checkbox][data-picker-choose]\", content).each((_index, checkbox) => {\n      const $checkbox = $(checkbox);\n      checkbox.checked = this._targetFromValue($checkbox.val()) !== null;\n    }).change((event) => {\n      const $checkbox = $(event.target);\n      if (event.target.checked) {\n        this._choose(\n          { url: $checkbox.data(\"picker-url\"), value: $checkbox.val() || \"\", text: $checkbox.data(\"picker-text\") || \"\" },\n          { modify: false, close: false }\n        );\n      }\n      else {\n        this._removeValue(this.current.picker, this._targetFromValue($checkbox.val()));\n      }\n    });\n  }\n\n  _choose(data, opts = {}) {\n    const options = Object.assign({ interactive: true, modify: true, close: true }, opts);\n\n    let dataText = this._escape(data.text);\n    let choosenOption = null;\n\n    if (!this.current.target && options.modify) {\n      this.current.target = this._targetFromValue(data.value);\n    }\n\n    // Add or update value appearance\n    if (this.current.target && options.modify) {\n      let link = $(\"a\", this.current.target);\n      link.data(\"picker-value\", data.value);\n      link.attr(\"href\", data.url);\n      choosenOption = this.current.target;\n      if (this.current.multiple) {\n        link.html(`&times;&nbsp;${dataText}`);\n      } else {\n        link.text(dataText);\n      }\n    } else {\n      let input = \"hidden\",\n          name = this.current.name;\n\n      if (this.current.multiple) {\n        name += \"[]\";\n        choosenOption = $(`<div><input type=\"${input}\" checked name=\"${name}\"/><a href=\"${data.url}\" data-picker-value=\"${data.value}\" class=\"label primary\">&times;&nbsp;${dataText}</a></div>`);\n      } else {\n        choosenOption = $(`<div><input type=\"${input}\" checked name=\"${name}\"/><a href=\"${data.url}\" data-picker-value=\"${data.value}\">${dataText}</a></div>`);\n      }\n      choosenOption.appendTo(this.current.values);\n\n      if (!this.current.target) {\n        this.current.target = choosenOption;\n      }\n    }\n\n    // Set input value\n    let $input = $(\"input\", choosenOption);\n    $input.attr(\"value\", data.value);\n\n    if (this.current.autosort) {\n      this._sort();\n    }\n\n    if (options.interactive) {\n      // Raise changed event\n      $input.trigger(\"change\");\n      this._removeErrors();\n\n      if (options.close) {\n        this._close();\n      }\n    }\n  }\n\n  _sort() {\n    const values = $(\".picker-values\", this.current.picker);\n    values.children().sort((item1, item2) => $(\"input\", item1).val() - $(\"input\", item2).val()).detach().appendTo(values);\n  }\n\n  _close() {\n    // Close modal and unset target element\n    this.modal.foundation(\"close\");\n    this.current.target = null;\n  }\n\n  _removeValue($picker, target) {\n    if (target) {\n      this._setCurrentPicker($picker, target);\n      // Fadeout (with time) doesn't work in system tests\n      let fadeoutTime = 500;\n      if (navigator && navigator.webdriver) {\n        fadeoutTime = 0;\n      }\n      this.current.target.fadeOut(fadeoutTime, () => {\n        this.current.target.remove();\n        this.current.target = null;\n      });\n    }\n  }\n\n  _removeErrors() {\n    let parent = this.current.picker.parent();\n    $(\".is-invalid-input\", parent).removeClass(\"is-invalid-input\");\n    $(\".is-invalid-label\", parent).removeClass(\"is-invalid-label\");\n    $(\".form-error.is-visible\", parent).removeClass(\"is-visible\");\n  }\n\n  _escape(str) {\n    return str.replace(/[\\u00A0-\\u9999<>&]/gim, function (char) {\n      return `&#${char.charCodeAt(0)};`;\n    });\n  }\n\n  _targetFromEvent(event) {\n    return event.target.parentNode;\n  }\n\n  _targetFromValue(value) {\n    return $(`[data-picker-value=${value}]`, this.current.picker).parent()[0] || null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}