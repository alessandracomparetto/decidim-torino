{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n/* eslint-disable require-jsdoc */\n\n\nvar DynamicFieldsComponent = /*#__PURE__*/function () {\n  function DynamicFieldsComponent() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, DynamicFieldsComponent);\n\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n\n    this._enableInterpolation();\n\n    this._activateFields();\n\n    this._bindEvents();\n  }\n\n  _createClass(DynamicFieldsComponent, [{\n    key: \"_enableInterpolation\",\n    value: function _enableInterpolation() {\n      $.fn.replaceAttribute = function (attribute, placeholder, value) {\n        $(this).find(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).addBack(\"[\".concat(attribute, \"*=\").concat(placeholder, \"]\")).each(function (index, element) {\n          $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n        });\n        return this;\n      };\n\n      $.fn.template = function (placeholder, value) {\n        // See the comment below in the `_addField()` method regarding the\n        // `<template>` tag support in IE11.\n        var $subtemplate = $(this).find(\"template, .decidim-template\");\n\n        if ($subtemplate.length > 0) {\n          $subtemplate.html(function (index, oldHtml) {\n            return $(oldHtml).template(placeholder, value)[0].outerHTML;\n          });\n        } // Handle those subtemplates that are mapped with the `data-template`\n        // attribute. This is also because of the IE11 support.\n\n\n        var $subtemplateParents = $(this).find(\"[data-template]\");\n\n        if ($subtemplateParents.length > 0) {\n          $subtemplateParents.each(function (_i, elem) {\n            var $self = $(elem);\n            var $tpl = $($self.data(\"template\")); // Duplicate the sub-template with a unique ID as there may be\n            // multiple parent templates referring to the same sub-template.\n\n            var $subtpl = $($tpl[0].outerHTML);\n            var subtemplateId = \"\".concat($tpl.attr(\"id\"), \"-\").concat(value);\n            var subtemplateSelector = \"#\".concat(subtemplateId);\n            $subtpl.attr(\"id\", subtemplateId);\n            $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n            $tpl.after($subtpl);\n            $subtpl.html(function (index, oldHtml) {\n              return $(oldHtml).template(placeholder, value)[0].outerHTML;\n            });\n          });\n        }\n\n        $(this).replaceAttribute(\"id\", placeholder, value);\n        $(this).replaceAttribute(\"name\", placeholder, value);\n        $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n        $(this).replaceAttribute(\"for\", placeholder, value);\n        $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n        $(this).replaceAttribute(\"href\", placeholder, value);\n        return this;\n      };\n    }\n  }, {\n    key: \"_bindEvents\",\n    value: function _bindEvents() {\n      var _this = this;\n\n      $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function () {\n          return _this._addField(_this.fieldTemplateSelector);\n        });\n      });\n\n      if (this.addSeparatorButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.separatorTemplateSelector);\n          });\n        });\n      }\n\n      if (this.addTitleAndDescriptionButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function () {\n            return _this._addField(_this.TitleAndDescriptionTemplateSelector);\n          });\n        });\n      }\n\n      $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, function (event) {\n        return _this._bindSafeEvent(event, function (target) {\n          return _this._removeField(target);\n        });\n      });\n\n      if (this.moveUpFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveUpField(target);\n          });\n        });\n      }\n\n      if (this.moveDownFieldButtonSelector) {\n        $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, function (event) {\n          return _this._bindSafeEvent(event, function (target) {\n            return _this._moveDownField(target);\n          });\n        });\n      }\n    }\n  }, {\n    key: \"_bindSafeEvent\",\n    value: function _bindSafeEvent(event, cb) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      try {\n        return cb(event.target);\n      } catch (error) {\n        console.error(error); // eslint-disable-line no-console\n\n        return error;\n      }\n    } // Adds a field.\n    //\n    // template - A String matching the type of the template. Expected to be\n    //  either \".decidim-question-template\" or \".decidim-separator-template\".\n\n  }, {\n    key: \"_addField\",\n    value: function _addField() {\n      var templateClass = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \".decidim-template\";\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector); // Allow defining the template using a `data-template` attribute on the\n      // wrapper element. This is to allow child templates which would otherwise\n      // be impossible using `<script type=\"text/template\">`. See the comment\n      // below regarding the `<template>` tag and IE11.\n\n      var templateSelector = $wrapper.data(\"template\");\n      var $template = null;\n\n      if (templateSelector) {\n        $template = $(templateSelector);\n      }\n\n      if ($template === null || $template.length < 1) {\n        // To preserve IE11 backwards compatibility, the views are using\n        // `<script type=\"text/template\">` with a given `class` instead of\n        // `<template>`. The `<template> tags are parsed in IE11 along with the\n        // DOM which may cause the form elements inside them to break the forms\n        // as they are submitted with them.\n        $template = $wrapper.children(\"template, \".concat(templateClass));\n      }\n\n      var $newField = $($template.html()).template(this.placeholderId, this._getUID());\n      $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n      var $lastQuestion = $container.find(this.fieldSelector).last();\n\n      if ($lastQuestion.length > 0) {\n        $lastQuestion.after($newField);\n      } else {\n        $newField.appendTo($container);\n      }\n\n      $newField.foundation();\n\n      if (this.onAddField) {\n        this.onAddField($newField);\n      }\n    }\n  }, {\n    key: \"_removeField\",\n    value: function _removeField(target) {\n      var $target = $(target);\n      var $removedField = $target.parents(this.fieldSelector);\n      var idInput = $removedField.find(\"input\").filter(function (idx, input) {\n        return input.name.match(/id/);\n      });\n\n      if (idInput.length > 0) {\n        var deletedInput = $removedField.find(\"input\").filter(function (idx, input) {\n          return input.name.match(/delete/);\n        });\n\n        if (deletedInput.length > 0) {\n          $(deletedInput[0]).val(true);\n        }\n\n        $removedField.addClass(\"hidden\");\n        $removedField.hide();\n      } else {\n        $removedField.remove();\n      }\n\n      if (this.onRemoveField) {\n        this.onRemoveField($removedField);\n      }\n    }\n  }, {\n    key: \"_moveUpField\",\n    value: function _moveUpField(target) {\n      var $target = $(target);\n      var $movedUpField = $target.parents(this.fieldSelector);\n      $movedUpField.prev().before($movedUpField);\n\n      if (this.onMoveUpField) {\n        this.onMoveUpField($movedUpField);\n      }\n    }\n  }, {\n    key: \"_moveDownField\",\n    value: function _moveDownField(target) {\n      var $target = $(target);\n      var $movedDownField = $target.parents(this.fieldSelector);\n      $movedDownField.next().after($movedDownField);\n\n      if (this.onMoveDownField) {\n        this.onMoveDownField($movedDownField);\n      }\n    }\n  }, {\n    key: \"_activateFields\",\n    value: function _activateFields() {\n      var _this2 = this; // Move the `<script type=\"text/template\">` elements to the bottom of the\n      // list container so that they will not cause the question moving\n      // functionality to break since it assumes that all children elements are\n      // the dynamic field list child items.\n\n\n      var $wrapper = $(this.wrapperSelector);\n      var $container = $wrapper.find(this.containerSelector);\n      $container.append($container.find(\"script\"));\n      $(this.fieldSelector).each(function (idx, el) {\n        $(el).template(_this2.placeholderId, _this2._getUID());\n        $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n      });\n    }\n  }, {\n    key: \"_getUID\",\n    value: function _getUID() {\n      this.elementCounter += 1;\n      return new Date().getTime() + this.elementCounter;\n    }\n  }]);\n\n  return DynamicFieldsComponent;\n}();\n\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}","map":{"version":3,"mappings":"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","names":["DynamicFieldsComponent","options","_classCallCheck","wrapperSelector","containerSelector","fieldSelector","addFieldButtonSelector","addSeparatorButtonSelector","addTitleAndDescriptionButtonSelector","fieldTemplateSelector","separatorTemplateSelector","TitleAndDescriptionTemplateSelector","removeFieldButtonSelector","moveUpFieldButtonSelector","moveDownFieldButtonSelector","onAddField","onRemoveField","onMoveUpField","onMoveDownField","placeholderId","elementCounter","_enableInterpolation","_activateFields","_bindEvents","$","fn","replaceAttribute","attribute","placeholder","value","find","addBack","each","index","element","attr","replace","template","$subtemplate","length","html","oldHtml","outerHTML","$subtemplateParents","_i","elem","$self","$tpl","data","$subtpl","subtemplateId","subtemplateSelector","after","on","event","_this","_bindSafeEvent","_addField","target","_removeField","_moveUpField","_moveDownField","cb","preventDefault","stopPropagation","error","console","templateClass","$wrapper","$container","templateSelector","$template","children","$newField","_getUID","$lastQuestion","last","appendTo","foundation","$target","$removedField","parents","idInput","filter","idx","input","name","match","deletedInput","val","addClass","hide","remove","$movedUpField","prev","before","$movedDownField","next","append","el","_this2","Date","getTime","createDynamicFields"],"sources":["/var/lib/gems/2.7.0/gems/decidim-admin-0.26.0/app/packs/src/decidim/admin/dynamic_fields.component.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\nclass DynamicFieldsComponent {\n  constructor(options = {}) {\n    this.wrapperSelector = options.wrapperSelector;\n    this.containerSelector = options.containerSelector;\n    this.fieldSelector = options.fieldSelector;\n    this.addFieldButtonSelector = options.addFieldButtonSelector;\n    this.addSeparatorButtonSelector = options.addSeparatorButtonSelector;\n    this.addTitleAndDescriptionButtonSelector = options.addTitleAndDescriptionButtonSelector;\n    this.fieldTemplateSelector = options.fieldTemplateSelector;\n    this.separatorTemplateSelector = options.separatorTemplateSelector;\n    this.TitleAndDescriptionTemplateSelector = options.TitleAndDescriptionTemplateSelector;\n    this.removeFieldButtonSelector = options.removeFieldButtonSelector;\n    this.moveUpFieldButtonSelector = options.moveUpFieldButtonSelector;\n    this.moveDownFieldButtonSelector = options.moveDownFieldButtonSelector;\n    this.onAddField = options.onAddField;\n    this.onRemoveField = options.onRemoveField;\n    this.onMoveUpField = options.onMoveUpField;\n    this.onMoveDownField = options.onMoveDownField;\n    this.placeholderId = options.placeholderId;\n    this.elementCounter = 0;\n    this._enableInterpolation();\n    this._activateFields();\n    this._bindEvents();\n  }\n\n  _enableInterpolation() {\n    $.fn.replaceAttribute = function(attribute, placeholder, value) {\n      $(this).find(`[${attribute}*=${placeholder}]`).addBack(`[${attribute}*=${placeholder}]`).each((index, element) => {\n        $(element).attr(attribute, $(element).attr(attribute).replace(placeholder, value));\n      });\n\n      return this;\n    }\n\n    $.fn.template = function(placeholder, value) {\n      // See the comment below in the `_addField()` method regarding the\n      // `<template>` tag support in IE11.\n      const $subtemplate = $(this).find(\"template, .decidim-template\");\n\n      if ($subtemplate.length > 0) {\n        $subtemplate.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n      }\n\n      // Handle those subtemplates that are mapped with the `data-template`\n      // attribute. This is also because of the IE11 support.\n      const $subtemplateParents = $(this).find(\"[data-template]\");\n\n      if ($subtemplateParents.length > 0) {\n        $subtemplateParents.each((_i, elem) => {\n          const $self = $(elem);\n          const $tpl = $($self.data(\"template\"));\n\n          // Duplicate the sub-template with a unique ID as there may be\n          // multiple parent templates referring to the same sub-template.\n          const $subtpl = $($tpl[0].outerHTML);\n          const subtemplateId = `${$tpl.attr(\"id\")}-${value}`;\n          const subtemplateSelector = `#${subtemplateId}`;\n          $subtpl.attr(\"id\", subtemplateId);\n          $self.attr(\"data-template\", subtemplateSelector).data(\"template\", subtemplateSelector);\n          $tpl.after($subtpl);\n\n          $subtpl.html((index, oldHtml) => $(oldHtml).template(placeholder, value)[0].outerHTML);\n        });\n      }\n\n      $(this).replaceAttribute(\"id\", placeholder, value);\n      $(this).replaceAttribute(\"name\", placeholder, value);\n      $(this).replaceAttribute(\"data-tabs-content\", placeholder, value);\n      $(this).replaceAttribute(\"for\", placeholder, value);\n      $(this).replaceAttribute(\"tabs_id\", placeholder, value);\n      $(this).replaceAttribute(\"href\", placeholder, value);\n\n      return this;\n    }\n  }\n\n  _bindEvents() {\n    $(this.wrapperSelector).on(\"click\", this.addFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, () => this._addField(this.fieldTemplateSelector))\n    );\n\n    if (this.addSeparatorButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addSeparatorButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.separatorTemplateSelector))\n      );\n    }\n\n    if (this.addTitleAndDescriptionButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.addTitleAndDescriptionButtonSelector, (event) =>\n        this._bindSafeEvent(event, () => this._addField(this.TitleAndDescriptionTemplateSelector))\n      );\n    }\n\n    $(this.wrapperSelector).on(\"click\", this.removeFieldButtonSelector, (event) =>\n      this._bindSafeEvent(event, (target) => this._removeField(target))\n    );\n\n    if (this.moveUpFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveUpFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveUpField(target))\n      );\n    }\n\n    if (this.moveDownFieldButtonSelector) {\n      $(this.wrapperSelector).on(\"click\", this.moveDownFieldButtonSelector, (event) =>\n        this._bindSafeEvent(event, (target) => this._moveDownField(target))\n      );\n    }\n  }\n\n  _bindSafeEvent(event, cb) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    try {\n      return cb(event.target);\n    } catch (error) {\n      console.error(error); // eslint-disable-line no-console\n      return error;\n    }\n  }\n\n  // Adds a field.\n  //\n  // template - A String matching the type of the template. Expected to be\n  //  either \".decidim-question-template\" or \".decidim-separator-template\".\n  _addField(templateClass = \".decidim-template\") {\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n\n    // Allow defining the template using a `data-template` attribute on the\n    // wrapper element. This is to allow child templates which would otherwise\n    // be impossible using `<script type=\"text/template\">`. See the comment\n    // below regarding the `<template>` tag and IE11.\n    const templateSelector = $wrapper.data(\"template\");\n    let $template = null;\n    if (templateSelector) {\n      $template = $(templateSelector);\n    }\n    if ($template === null || $template.length < 1) {\n      // To preserve IE11 backwards compatibility, the views are using\n      // `<script type=\"text/template\">` with a given `class` instead of\n      // `<template>`. The `<template> tags are parsed in IE11 along with the\n      // DOM which may cause the form elements inside them to break the forms\n      // as they are submitted with them.\n      $template = $wrapper.children(`template, ${templateClass}`);\n    }\n\n    const $newField = $($template.html()).template(this.placeholderId, this._getUID());\n\n    $newField.find(\"ul.tabs\").attr(\"data-tabs\", true);\n\n    const $lastQuestion = $container.find(this.fieldSelector).last()\n    if ($lastQuestion.length > 0) {\n      $lastQuestion.after($newField);\n    } else {\n      $newField.appendTo($container);\n    }\n\n    $newField.foundation();\n\n    if (this.onAddField) {\n      this.onAddField($newField);\n    }\n  }\n\n  _removeField(target) {\n    const $target = $(target);\n    const $removedField = $target.parents(this.fieldSelector);\n    const idInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/id/));\n\n    if (idInput.length > 0) {\n      const deletedInput = $removedField.find(\"input\").filter((idx, input) => input.name.match(/delete/));\n\n      if (deletedInput.length > 0) {\n        $(deletedInput[0]).val(true);\n      }\n\n      $removedField.addClass(\"hidden\");\n      $removedField.hide();\n    } else {\n      $removedField.remove();\n    }\n\n    if (this.onRemoveField) {\n      this.onRemoveField($removedField);\n    }\n  }\n\n  _moveUpField(target) {\n    const $target = $(target);\n    const $movedUpField = $target.parents(this.fieldSelector);\n\n    $movedUpField.prev().before($movedUpField);\n\n    if (this.onMoveUpField) {\n      this.onMoveUpField($movedUpField);\n    }\n  }\n\n  _moveDownField(target) {\n    const $target = $(target);\n    const $movedDownField = $target.parents(this.fieldSelector);\n\n    $movedDownField.next().after($movedDownField);\n\n    if (this.onMoveDownField) {\n      this.onMoveDownField($movedDownField);\n    }\n  }\n\n  _activateFields() {\n    // Move the `<script type=\"text/template\">` elements to the bottom of the\n    // list container so that they will not cause the question moving\n    // functionality to break since it assumes that all children elements are\n    // the dynamic field list child items.\n    const $wrapper = $(this.wrapperSelector);\n    const $container = $wrapper.find(this.containerSelector);\n    $container.append($container.find(\"script\"));\n\n    $(this.fieldSelector).each((idx, el) => {\n      $(el).template(this.placeholderId, this._getUID());\n\n      $(el).find(\"ul.tabs\").attr(\"data-tabs\", true);\n    })\n  }\n\n  _getUID() {\n    this.elementCounter += 1;\n\n    return (new Date().getTime()) + this.elementCounter;\n  }\n}\n\nexport default function createDynamicFields(options) {\n  return new DynamicFieldsComponent(options);\n}\n"]},"metadata":{},"sourceType":"module"}